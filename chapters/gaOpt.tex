\chapter{Neutronic Optimization}
\label{ch:GAOpt}
\section{Introduction}
Effective utilization of the neutron flux and is necessary for minimizing the amount of neutron absorber (\iso[6]{Li}) that is used in the detector.

Several possible geometries have been considered for the films. 
They are generally a vertical or horizontal layer of the films or a vertical or horizontal arrangement of the films arranged in concentric cylinders.
\section{Methods}

%%%
A fast simulation model (XSDRN) will be used to preform an initial parameter study and determine a subset of optimal geometries on which to preform more accurate Monte Carlo (MCNPX) modeling. 
A subset of the highest preforming geometries validated by the detailed model with then be used to test the sensitivity by adjusting the position of the films by fractional amounts.
%%%
In this particular problem the placement of a film greatly changes the solution because of the large change in the neutron flux, and traditional gradient based solvers would tend to be trapped in these local minima.
Genetic algorthims were chosen as the optimization technique because they are less suscutible to local minimas than other search techniques and tend to preform very well on combinitorial problems such as this one \cite{Mitchell}.

\subsection{Genetic Algorithm Introduction}
Genetic algorthims provide a search technique analagous to biological evolution in which instead of searching from general to specific solutions, or from more simple to complex, genetic algorthims generate solutions by mutating and combining parts of the best previously known solutions.
At each step in the search for the best solution a collection of solutions called the current \textit{population} is refined by replacing members with solutions representing the offspring of the best individuals.
The goals is then to find the best solution to the problem as determined by some criteria, called the \textit{fitness function}.
The genetic algorithm typically consist of four tasks: creating an initial population, evaluating that populations fitness, selecting members of the current population to breed, and then applying genetic operators to the selected members to breed the new population. 
This is completed until either a maximum generation is reached or the desired fitness is achieved, as shown in \autoref{alg:GAOutline}.
\begin{algorithm}
  \caption{Genetic Program Outline}
  \label{alg:GAOutline}
  \begin{algorithmic}
    \WHILE{$error>goal$}
      \FORALL{$t\in F$}
        \STATE{Compute fitness}
      \ENDFOR
      \FORALL{$t\in F$
        \STATE{Choose individuals based on fitness}
      \ENDFOR
      \STATE{Select individuals for next population}
      \STATE{Crossover selected individuals}
      \STATE{Mutate selected individual}}}
    \ENDWHILE
  \end{algorithmic}
\end{algorithm}

\subsubsection{Problem Representaiton}
The thickness of the RPM  (\SI{12.7}{\cm}) was divided into slices, where each slice could be either a detector slice or a moderator slice.
These slices of detector material (represented as a \verb+1+) or moderator material (represented as a \verb+0+) were appened into a sequence.
This sequence of one's and zero's (or bit string) then completely represented the goemetry of the RPM and formed the basis for all possible solutions to the optimization problem.
For example the sequence \verb+0001110010+ would represent a detector that had three moderator slices, three detector slices, another two moderator slicees, and a final detector slice before a single moderator slice as the reflector.
Examples of two differnet genomes are shown in \autofref{fig:ExGeoGenomes}
\begin{figure}

  \caption[Example Geometries Genomes]{Example of Geometry Genomes}
  \caption{fig:ExGeoGenomes}
\end{figure}
In terms of genetic algorthims the set of all possible solutions is refered to as the \textit{genome}.
The length of the genome is thus the number of slices in the geometry, where a higher length genome allows for a more complicated geoemtry.
The intial population for the genetic algorthim was initialized to be random bit strings with equal probability of a slice being a detector slice or moderator.

\subsection{Population Selection}

Population selection was achieved using a hybrid approach of tournament
selection and rank selection. In rank selection the individuals were
selected based on their rank, where the rank was determined by their
fitness (lower SSE correspond to a higher fitness). Tournament selection
was used to generate the other component of the population for breeding.
\subsection{Genetic Operators}

Individuals selected for reproduction are subjected to genetic operators
to breed the next generation. Genetic programs generally contain two
genetic operators, crossover and mutation. Crossover serves to create
new members of the population by interchanging the genetic material
(tree structure) of two parents in which significant changes in the
tree solutions are achieved. Mutation serves to slightly modify an
existing solution. 


\subsubsection{Crossover}

Crossover is defined in genetic programming as the swapping of sub-trees
between individuals in the population, which is meant to mimic the
crossover of genes that occurs during evolution. As the solutions
are recursively defined, crossover was implemented by selecting randomly
selecting a two nodes from different trees and swapping their parents.
Crossover, in which two individuals are breed in produce the new generataion was implemented as \textbf{VALUE}.
An example of the crossover operations is shown in the Figure ~\ref{figGeneticCrossover}.
\begin{figure}
    \missingfigure{Crossover examples}
    \caption[Genetic Crossover Operations]{Genetic Crossover Operations}
    \label{fig:GeneticCrossover}
\end{figure}


\subsubsection{Mutation}

Mutation, unlike crossover, does not involve changes to the structure
of the solution but rather operators within the solution. For example,
in symbolic regression mutation will randomly (defined by the mutation
rate) change the node function and leaf values, but it will not add
or prune branches to the tree structure. Mutation was implemented
as a recursive traversal of the tree, switching the function types
with other functions types according to a user supplied probability.
The terminals mutations were implemented in a similar fashion, but
if the node was a value leaf the leaf was randomly set to a new random
variable. 
The mutation operation was chosen to be a simple bit flip in which a randomly chosen \verb+1+ or \verb+0+ in the geoemtry was flipped; for example \verb+001001010+ could be mutated to \verb+001001000+.
\subsubsection{Selection Techniques}
Several differnet selection technqiues are available to select the individuals from one population to reproduce in the next.
Among the most common are fitness proportional selection (roulette selection) and tournament selection.

Fitness proporitional selection (or roulette selection) occurs when the individuals are ranked by their fitness, and individuals are chosen by their fitness rank.
Imagine a roulette wheel where the space a canidate occupies on the wheel is proporitonal to its fiteness.  
Higher fitness individuals will occupy more space, and will thus have a higher probability of being selected.


The fitness function was choosen to count rate per mass of \iso[6]{Li}, provided that the geometry meet the total count rate criteria.
If it failed to meet the count rate criteria a zero fitness was returned \eqref{eqn:FitnessFun}.
\begin{align}
    \label{eqn:FitnessFun}
    f(\vec{x})
    = \begin{cases}
    0 & \text{if} \text{countRate}(\vec{x}) \leq \SI{2.5}{cps\per\nano\gram\iso[252]{Cf}} \\
    \text{countRatePerMass}(\vec{x})
    \end{cases}
\end{align}

\input{MCNPXModel}

However, not all of these interactions will lead to counts above the pulse height discriminator setting necessary for meeting the gamma intrinsic efficiency.
This is corrected for by scaling $I_{\text{sim}}$ by the fraction of counts, $\eta$, that occur above the gamma LLD \eqref{eqn:FractionOfCountsDefination}, \eqref{eqn:RPMCountRate}.
\begin{align}
  \label{eqn:FractionOfCountsDefination}
  \eta \equiv \frac{\int_{MLLD}^\infty p(x)dx}{\int_0^\infty p(x)dx}
\end{align}
\nomenclature{$p(x)$}{Measured spectra, as a function of channel number}
\begin{align}
 \label{eqn:RPMCountRate}
 \text{Count Rate} &= I_{\text{sim}} \eta
\end{align}

\input{XSDRNModel}


Further refinement of the spacing could be completed in the MCNPX calculations by adjust the slices a millimeter to the left or right for each one.

\section{Conclusions}

A physical basis of the optimal solution found by the genetic algorthim can be found by observing the form of the optimal solutions.
These solutions involve an intial moderator layer in order to ensure that all of the neutrons are thermalized to (increasing the thermal fraction by \textbf{SOME PRECENT}).
After this moderator layer a film layer is placed to utilize this neutron spectra; however not all of the thermal neutrons are captured (as the mean free path of a neutron in polyethylene is about \si{0.37}{\cm} and thus some pass through the material) and another abosrber layer is needed to capture those neutrons.  
The neutron flux is then moderated again, and additional layers of detectors are needed to capture this neutron cross section.
However, it is desirably to have a large neutron reflector in the portal monitor to reflect neturons back into the detector slices. 
Theortically this reflector should be as large as possible, but the limited space of the RPM provides a constraint.
A parameter study with a single detector slice between a moderator and reflector constrained by the radiaiton portal monitor design showed that it is desriable to have around \textbf{So much} moderator leaving the majority of the RPM to be left for the reflector.
Thus it is demonstrated that a large reflector is desired.
